# TWSVP 页面内容架构（完整版）

## 全局约束（所有页面共用）

### 系统后台任务
- 定时任务（Cron）仅两项：
  - 每日 17:00 同步股价（台北时间，Vercel Cron 需配置为 UTC `0 9 * * *`）
  - 每小时 1 次回补历史股价
- 股价同步固定使用 FinMind，数据起点统一为 `2026-01-01`，同步范围覆盖上市/上柜全部股票（历史 + 增量）
- 增量同步默认从最新交易日继续拉取，可用 `start_date` 或 `STOCK_PRICE_SYNC_START_DATE` 指定起始日（例如 `2026-01-01`）
- 历史回补（backfill）同样固定使用 FinMind，起始日不可早于 `2026-01-01`
- 必要时 `purge=1` 先清洗误数据，全量清空可传 `purge_all=1&purge_confirm=DELETE_ALL`

### 主框架分层
- 顶部栏
- 置顶内容层
- 内容层
- 底部Tab

### 固定层与内容避让
- 内容层需要预留顶部栏 + 筛选 Tab 的高度，避免首条卡片被遮挡
- 卡片的更多菜单应覆盖在固定层之上，确保下拉完整可见
- 搜索框与置顶输入区需要避开顶部导航与安全区，避免被遮挡

### 底部Tab 固定
- 观点流
- 搜索
- 发布
- 通知
- 个人中心

### 发布入口
- FeedFlow 置顶悬浮卡片
- 底部Tab「发布」

### 列表默认排序
- 默认：时间倒序（最新优先）
- 可切换：热度（互动数加权）
- 所有列表分页：每页 20 条，滚动/点击加载更多

### 顶部 Tab 行为
- 顶部 Tab 固定在最上方
- 向下滚动自动收起，向上滚动自动显示

---

## 1) 观点流 FeedFlow（首页）

### 顶部栏
| 观点流（页面名称） | 搜索入口（跳 Search） |
|------------------|----------------------|

### 置顶内容层
| 发布入口（悬浮卡片 / 轻量输入引导） |
|----------------------------------|

> 悬浮卡片建议内容：“分享你的观点…”

### 内容层
| FeedList（按时间/热度） |
|----------------------|
| FeedFilter / FeedSort（全部 / 未结束 / 已结束） |
| 首条卡片与置顶筛选 Tab 对齐，不出现多余空白 |

**建议把筛选拆成两层：**
- Sort：时间 / 热度
- Filter：全部 / 未结束 / 已结束（状态筛选）

### 底部Tab
| 观点流（高亮） | 搜索 | 发布 | 通知 | 个人中心 |
|--------------|------|------|------|----------|

---

## 2) 搜索 Search

### 顶部栏
| 搜索（页面名称） |
|----------------|

### 置顶内容层
| 搜索框（输入关键词） |
|------------------|
| 搜索按钮（点击后显示“搜索中...”并禁用） |
| Tab：观点（Feed） | 个股（Stock） | 话题（Theme） | 用户（User） |
> 搜索框需避开顶部导航与安全区，确保输入不被遮挡

### 内容层
根据 Tab 展示不同结果列表

**默认排序：**
- Feed：匹配度优先，其次时间
- Stock/Theme/User：完全匹配优先，其次热度（可选）

### 底部Tab
| 观点流 | 搜索（高亮） | 发布 | 通知 | 个人中心 |
|------|------------|------|------|----------|

---

## 3) 发布 CreateFeed（底部 Tab 入口）

> *是一个抽屉式弹窗，不是一个新页面*

### 顶部栏
| 发布观点（页面名称） | 关闭/返回 |
|------------------|----------|

### 置顶内容层
| 标的选择（输入公司名称/股票代码并从数据库结果确认） |
|----------------------------------------------|
| 看法：看多 / 看空 / 中性 |
| 时效：短期（5–20天）/ 中期（20–60天）/ 长期（60–180天） |

### 内容层
*String文字*
*Placeholder：
- 观点的一句话结论
- 你的判断依据
- 风险提示

### 底部固定操作区（推荐）
| 发布按钮（校验通过可点） |
|----------------------|

### 底部Tab
| 观点流 | 搜索 | 发布（高亮） | 通知 | 个人中心 |
|------|------|------------|------|----------|

---

## 4) 通知 Notification

### 顶部栏
| 通知（页面名称） |
|----------------|

### 置顶内容层
| Tab：点赞 | 分享 | 即期观点（到期提醒） |
|---------|------|----------------------|

### 内容层
根据 Tab 展示通知列表（与置顶 Tab 保持间距，避免遮挡首条通知）
触底自动加载分页，不使用“加载更多”

**排序：** 时间倒序

**通知项结构：**
- 头像 + 动作 + 时间
- 观点摘要...
- 点击 → FeedCard

### 底部Tab
| 观点流 | 搜索 | 发布 | 通知（高亮） | 个人中心 |
|------|------|------|------------|----------|

---

## 5) 个人中心 PersonalCenter（= PersonalUser）

### 顶部栏
| 个人中心（页面名称） | 设置入口（跳 Setting） |
|------------------|----------------------|

### 置顶内容层
| 头像 | 昵称 |
|------|------|
| 被关注数 | 观点数 | 首次登录时间 |
| 个人介绍 |
| 感兴趣行业标签（建议补：让画像可见） |

### 内容层
| 观点胜率 | 观点绩效 |
|---------|---------|
| Tab：全部观点 | 未结束 | 已结束 |
| 个人观点流（列表） |
触底自动加载分页，不使用“加载更多”

### 底部Tab
| 观点流 | 搜索 | 发布 | 通知 | 个人中心（高亮） |
|------|------|------|------|----------------|

---

## 6) 设置 Setting

### 顶部栏
| 设置（页面名称） | 返回 |
|----------------|

### 置顶内容层
| 当前账号信息（头像 / 昵称 / email） |
|--------------------------------|

### 内容层（分组列表）

#### A. 个人资料
- 编辑个人资料（跳 ProfileEdit / 复用 PersonalSetting 表单）

#### B. 账号与安全
- 绑定账号信息（只读：Google）
- 登出（Logout）

---

## 6.2 ProfileEdit

### 顶部栏
| 编辑资料（页面名称） | 保存 |
|------------------|------|

### 置顶内容层
| 头像（可更换） |
|--------------|
| 昵称（可编辑） |
| 个人介绍（多行） |

### 内容层
| 感兴趣行业（多选，上限 3–5） |
|--------------------------|

---

## 6.3 IndustrySelect（行业选择页，可选独立）

### 顶部栏
| 选择感兴趣行业 | 保存 |
|--------------|------|

### 置顶内容层
| 搜索行业（可选） |
|--------------|

### 内容层
| 行业列表（多选，上限 3–5） |
|------------------------|
