# 需求与数据接入记录 (2026-01-26)

## 已完成（数据库直接驱动视图）
- `src/services/feeds.js` 中完成了 `fetchFeedsSupabase` / `fetchFeedsBySymbolSupabase` / `fetchFeedByIdSupabase` 等函数，直接从 Supabase 的 `feeds` 表拉取结构化观点、作者、互动计数，并在 `FeedView.vue`、`ProfileView.vue`、`PersonalViewerView.vue`、`StockFeedView.vue`、`FeedCardView.vue` 等页面调用；代表整个 Feed 流已经改为真实数据库响应。
- `src/services/stocks.js` 的 `fetchStockByIdSupabase` 与 `fetchStockPricesSupabase` 已经把 `stocks` 与 `stock_prices` 表数据拉下来，并在 `StockFeedView.vue` 中同步展示行情数据与最近指标（包括 `fetchStockPricesSupabase(symbol, 60)`）。
- `src/services/notifications.js` 直接在 `notifications` 表上查询，`NotificationsView.vue` 使用 `fetchNotificationsSupabase` 将用户通知列表、已读状态和关联头像渲染出来，代表通知页已经与数据库联动。
- Supabase 账号、`users`/`profiles` 表的同步逻辑在 `src/services/auth.js` 中完成（`ensureProfileSupabase` 和 `getProfileCompletionSupabase`），覆盖登录后的 profile 创建/更新与完整度判断，说明认证流程与数据库写入现已就绪。

## 待继续推进
- Feed 交互（like/bookmark/share）、编辑/删除/结束观点、分页、搜索联想等仍需要在数据库级别补充对应操作或 API，目前只是读取层面的实现（参考 `feeds.js` 中还有未封装的操作）。
- 后端服务（`server/src/index.js`）目前只提供 Google OAuth + `posts` 接口，还没有把 Supabase 的数据暴露为 REST API；如果后续计划将前端流量转给自建 API，则需要在服务器端加入与 `feeds`/`notifications`/`stocks` 表一致的查询逻辑并同步 JWT 或 Supabase Token 签发。
- Cron 同步脚本（`api/sync-stock-prices*.js` + `vercel.json` 的两个定时任务）还未与前端/后端的查询缓存打通，需要确认同步后的 `stock_prices` 表被前端 `fetchStockPricesSupabase` 正常读取且不会出现数据延迟或冲突。
