generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ViewDirection {
  long
  short
  neutral
}

enum ViewEndType {
  manual_early
  manual_on_time
  manual_late
  auto_expired
}

enum ViewStatus {
  active
  closed
}

model User {
  id            String   @id @default(cuid())
  oauthProvider String
  oauthSub      String
  username      String   @unique
  email         String   @unique
  avatarUrl     String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  views         View[]

  @@unique([oauthProvider, oauthSub])
}

model View {
  id          String        @id @default(cuid())
  userId      String
  assetCode   String        @db.VarChar(10)
  direction   ViewDirection
  timeHorizon Int
  startTime   DateTime
  startPrice  Decimal       @db.Decimal(12, 4)
  endTime     DateTime?
  endPrice    Decimal?      @db.Decimal(12, 4)
  endType     ViewEndType?
  returnPct   Decimal?      @db.Decimal(7, 4)
  status      ViewStatus
  content     String        @db.Text
  hashtags    Json
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  user        User          @relation(fields: [userId], references: [id])

  @@index([assetCode])
  @@index([status, direction])
  @@index([startTime])
  @@index([endTime])
  @@index([userId])
}
